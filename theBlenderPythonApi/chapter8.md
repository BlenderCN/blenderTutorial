# 纹理和渲染

到目前为止，我们已经将代码示例限制为在Blender中创建网格和插件。对于3D艺术家和动画师来说，
3D建模的目标是通过渲染的图像和视频使场景变得生动。在Blender Python中渲染实际上非常简单，
通常只需要一个函数调用。为了让我们达到想要渲染场景的程度，我们将讨论纹理，灯光和相机布局。

到本章结束时，用户将能够创建用于纹理，灯光，相机放置和静态渲染的自动化管道。
虽然可以使用Blender Python渲染动画视频，但我们将在此讨论限制为渲染静止图像。

## 纹理词汇

一般来说有很多类型的纹理，Blender中有许多额外的参数化类型。
我们的第一个示例使用漫反射贴图和法线贴图来说明材质在Blender中的功能。
在我们继续之前，我们将建立一些关于纹理的新词汇。

### Blender中的影响类型

虽然这些效果在Blender中被归类为影响，但它们传统上指的是3D建模的广泛领域中的纹理类型。Blender有自己的纹理类型，
每种纹理都可以采用任何这些影响。有关这些影响在Blender GUI中的位置，请参见图8-1.
它们可以在 Properties>Materials>Influence中找到。

    *漫反射纹理用于着色对象。漫反射纹理可以描述Blender中对象的颜色，强度，alpha级别和半透明度。为了将图像叠加在对象的面上，我们使用漫反射颜色纹理。
  
    *着色纹理描述对象如何与场景中的其他交互。如果我们希望对象镜像另一个，将颜色发射到另一个，或将环境光溢出到场景中，我们在Blender中指定必需的着色属性。
  
    *镜面纹理描述了物体对光的反应。例如，如果我们提供静态模糊图像(如在旧电视屏幕上可能看到的那样)作为镜面纹理，则光会像闪亮的沙粒一样从物体上反射出来。我们可以通过指定颜色对光的反应强度和方向来微调镜面反射贴图。
  
    *几何纹理允许对象影响对象的几何外观。例如，如果我们为几何图提供黑白条纹并指定法线贴图，我们会在模型中看到3D脊。重要的是要注意，这些效果仅在渲染中实现，而不是在网格数据本身中实现。
  
图8-1
  
![](https://github.com/BlenderCN/blenderTutorial/blob/master/mDrivEngine/8-1.png?raw=true)

### Blender中的纹理类型

虽然我们主要使用图像纹理，但Blender有许多我们可以选择的可自定义纹理。这些是从图8-2所示的Properties>Materials>Type菜单中选择的。

图8-2

![](https://github.com/BlenderCN/blenderTutorial/blob/master/mDrivEngine/8-2.png?raw=true)

图像和视频和环境贴图选项可以导入图像和视频文件。剩余的纹理可以在Blender中进行参数化，以获得所需的结果。
我们没有详细说明如何使用这些参数化纹理中的任何一个，就像要讨论的许多参数一样。
清单8-1解释了如何使用Image和Video类型来给对象纹理。从这里开始，
读者应该能够使用Blender的Python工具提示为任何剩余类型复制此过程。

## 添加和配置纹理

在讨论文件交换格式时，我们在第4章中讨论了纹理的定义。纹理通过uv坐标映射到3D空间中的面。
要将方形图像作为纹理映射到网格的正方形面，
我们将uv坐标[(0,0),(1,0),(0,1),(1,1)]分别指定到网格的左下角，，右下角，左上角和右上角。
随着面的形状变得更加复杂，实现期望的纹理所需的过程也变得更加复杂。我们接下来讨论将uv坐标映射到常见形状的方法。

### 加载纹理和生成UV映射

由于Blender处理纹理导入和材质的方式，uv映射不是一个完全简单的任务。我们必须克服一些程序障碍，
以便在我们的脚本中达到我们可以在我们的对象上明确定义uv坐标的点。一旦我们达到这一点，
uv坐标的精确规范就相当简单。我们通过清单8-1中的示例进行解释。

我们在示例中使用了数字1和数字2的示例图像，
可以从http://blender.chrisconlan.com/number_1.png 和 http://blender.chrisconlan.com/number_2.png 下载。
读者可以使用这些图像或清单8-1中的任何其他所需图像。结果见图8-4.我们将在以下部分讨论清单8-1中使用的函数。

图8-3

![](https://github.com/BlenderCN/blenderTutorial/blob/master/mDrivEngine/8-3.png?raw=true)

清单8-3。加载纹理和生成uv映射。

   import bpy
   import bmesh
   from mathutils import Color
   
   #
   
![](https://github.com/BlenderCN/blenderTutorial/blob/master/mDrivEngine/8-4.png?raw=true)   

### Blender中的纹理与材质

纹理是3D建模中的一个广义术语。它可以指漫反射纹理，颜色纹理，渐变纹理，凹凸贴图等。重要的是要注意，
我们可以同时将所有这些纹理形式映射到对象。例如，房屋屋顶上的一组瓦可能需要图像纹理，漫反射贴图和凹凸贴图，
以便在渲染时显得逼真。

另外，通常将真实世界材料的图像，漫反射贴图和凹凸贴图彼此专门构建。在我们的瓦示例中，
凹凸贴图将定义物理挖在图像纹理中出现的脊。漫反射贴图将进一步定义我们通常在屋顶瓦片看到的闪亮粒子。
按照设计，表示图像和地图文件不一定适用于集合外部的其他文件。这是Blender材料的动力。

Blender中的材质是纹理相关数据的集合。它可能包括前面提到的任何图像和贴图，它可能包括其他法线和alpha贴图。
因此，我们必须首先从其构成纹理构建材质，然后将材质指定给对象。无论我们是否有一个或多个包含材质的纹理，
都必须将纹理数据分配给材质。然后，必须将材质指定给对象。

这个讨论揭示了清单8-1中材料管理背后的动机。我们首先声明并操作所有必需的纹理，
然后通过bpy.context.object.data.materials.append()将整个材质添加到对象。从这里，我们可以操纵整个材料的uv坐标。

### UV坐标和循环

清单8-1的后半部分访问了我们以前没有使用过的数据端点。我们要访问的ub坐标数据层包含在循环对象中。
循环可以被认为是跟踪3D对象的一组顶点的3D多边形。循环可以跨越多个面，但必须在同一点开始和结束。
当循环跨越多个面时，它们旨在捕获一组局部的相邻面。

3D艺术家可以使用高级工具来帮助他们创建循环。这些循环然后帮助他们手动分配uv坐标。
虽然我们不会在Blender Python中操作这些循环，但了解它们是如何工作的很重要，因为循环数据对象位于网格本身和uv层之间。

幸运的是，Blender中的循环数据对象与bmesh.faces[].verts[]对象具有1对1的对应关系，我们习惯使用它们。
换句话说，任意两个整数，f和v，bm.faces[f].loops[v][uv_layer].uv访问的(u,v)坐标对应于bm.faces[f].verts[v].co访问的(x,y,z)坐标。
